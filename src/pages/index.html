<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <style>
        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
            background: transparent;
        }
        *::-webkit-scrollbar-thumb {
            background: rgba(70, 70, 70, 0.2);
        }
        /* #editor {
            background: url(../../assets/images/background-grid.png), url(../../assets/images/background-gradient.png);
            background-position: center, center;
            background-size: contain, cover;
        } */
/* 		
        #editor {
            background: url(../assets/background.png);
            background-position: center;
            background-size: cover;
        }
		 */
    </style>
    <style id="configurableStyle"></style>
    <title>NoteFinity</title>
</head>
<body class="rounded-md select-none">
    <header class="w-full flex flex-col">
        <div class="flex justify-between items-center w-full h-8 px-2" id="headerPane" style="-webkit-app-region: drag;">

        </div>
        <ul class="w-full h-6  flex items-center justify-start" id="headerNavigation">
            <li class="navlist-item">
                <span>File</span>
                <ul class="navlist-sublist w-40 ml-1">
                    <li>New (Ctrl+N)</li>
                    <li>Open (Ctrl+O)</li>
                    <li>Open Folder</li>
                    <li>Open Recent Files</li>
                    <li>Save (Ctrl+S)</li>
                    <li>Save As (Ctrl+Shift+S)</li>
                    <li>Save All</li>
                    <hr>
                    <li>Quick Export</li>
                    <hr>
                    <li>Rename</li>
                    <hr>
                    <li>Close (Ctrl+W)</li>
                    <li>Close All</li>
                    <li>Close All but Active Document</li>
                    <li>Close All to the left</li>
                    <li>Close All to the right</li>
                    <hr>
                    <li>Exit</li>
                </ul>
            </li>
            <li class="navlist-item">
                <span>Edit</span>
                <ul class="navlist-sublist w-32">
                    <li>Undo (Ctrl+Z)</li>
                    <li>Redo (Ctrl+Y)</li>
                    <li>Time/Date (F5)</li>
                </ul>
            </li>
            <li class="navlist-item"><span>View</span></li>
            <li class="navlist-item">
                <span>Options</span>
                <ul class="navlist-sublist w-32">
                    <li>Change Language</li>
                    <li>Encrypt File</li>
                </ul>
            </li>
            <li class="navlist-item">
                <span>Customization</span>
                <ul class="navlist-sublist w-32">
                    <li onclick="openModal('frame')">Frame</li>
                    <li onclick="openModal('theme')">Theme</li>
                    <li onclick="openModal('textbox')">Textbox</li>
                </ul>
            </li>
            <li class="navlist-item"><span>Help</span></li>
        </ul>
    </header>
    <div id="editor" class="absolute w-full top-14 bottom-7 left-0 right-0 outline-0 z-0"></div>
    <div class="w-full h-7 flex items-start justify-start fixed bottom-0 px-1 overflow-hidden whitespace-nowrap overflow-x-auto tabscroll" id="tabscroll">
        <div class="tabitem">Untitled <span class="tabitem-close">&times;</span></div>
        <div class="tabitem">package.json <span class="tabitem-close">&times;</span></div>
        <div class="tabitem">index.html <span class="tabitem-close">&times;</span></div>
        <div class="tabitem">script.js <span class="tabitem-close">&times;</span></div>
        <div class="tabitem tabitem-active">style.css <span class="tabitem-close">&times;</span></div>
    </div>
    <script src="../../assets/js/ace.js"></script>
    <script src="../../assets/js/compulsory.js"></script>
    <script src="../../assets/js/framecomponents.js"></script>
    <script src="../../assets/js/themes.js"></script>
    <script src="../../assets/js/htmlrootclasses.js"></script>
    <script>        
        const tabscroll = document.getElementById('tabscroll');

        tabscroll.addEventListener("wheel", (e)=>{
            if (e.deltaY > 0) {
                tabscroll.scrollLeft += 20;
            }
            else {
                tabscroll.scrollLeft -= 20;
            }
        })
        function saveAsPDF() {
            let contents = _id("contents").value;
            
        }
        const editor = ace.edit("editor", {
            theme: "ace/theme/chrome",
            fontSize: "16px",
            mode: "ace/mode/text",
            showPrintMargin: false,
        });
        editor.session.setUseWrapMode(true);
        editor.focus();

        

        // editor.setHighlightActiveLine(false);


        const {ipcRenderer} = require("electron");

        function appAction(action) {
            ipcRenderer.send("appAction", action);
        }

        document.addEventListener("keydown", function(event) {
            if (event.ctrlKey && event.key === "r") {
                event.preventDefault();
            }
            if (event.ctrlKey && event.shiftKey && event.key === "s") {
                event.preventDefault();
                alert("ctrl+alt+s pressed")
            }
        });

        function openModal(modal) {
            editor.focus();
            ipcRenderer.send("open-modal", modal);
        }

        function isColorLight(color) {
            let r = parseInt(color.slice(1, 3), 16);
            let g = parseInt(color.slice(3, 5), 16);
            let b = parseInt(color.slice(5, 7), 16);

            let relativeLuminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;

            return relativeLuminance > 0.5;
        }



        function checkCustomizationFrame() {
            let customizationFrameData = localStorage.getItem("customizationNavigation");

            if (customizationFrameData != null) {
                customizationFrameData = JSON.parse(customizationFrameData);
                getHeader(customizationFrameData.alignment, customizationFrameData.navigationPane);

                if (customizationFrameData.navigationPane == 3) {
                    _cls("panel-round-exit")[0].style.background = customizationFrameData.colors.close;
                    _cls("panel-round-minimize")[0].style.background = customizationFrameData.colors.minimize;
                    _cls("panel-round-maximize")[0].style.background = customizationFrameData.colors.maximize;
                }
            }
            else {
                getHeader("nba", 3);
            }

        }
        ipcRenderer.on("check-customization-frame-check", (event, data)=>{
            checkCustomizationFrame();
        })
        checkCustomizationFrame();

        function refreshTheme() {
            let themeData = localStorage.getItem("activeTheme");
            if (themeData != null) {
                themeData = JSON.parse(themeData);
            }
            else {
                themeData = themes["Icy Blue"];
            }
            document.body.className = rootClasses.body + " " + themeData.playground;
            _id("tabscroll").className = rootClasses["#tabscroll"] + " " + themeData.playground;
            document.getElementsByClassName("tabitem-active")[0].className = rootClasses[".tabitem-active"] + " " + themeData.tabactive;
            _elms(".navlist-sublist li").forEach(element => {
                element.className = rootClasses[".navlist-sublist li"] + " " + themeData.navigationList;
            });
            _cls("navlist-item").forEach(element => {
                element.className = rootClasses[".navlist-item"] + " " + themeData.navigation;
            });
        }
        ipcRenderer.on("check-theme-check", (event, data)=>{
            refreshTheme();
        })
        refreshTheme();

        function refreshTextboxTheme() {
            let textboxThemeData = localStorage.getItem("activeTextBoxTheme");
            let textBoxThemeID = "chrome";
            let textBoxThemeImage = false;
            let textBoxGrid = true;
            if (textboxThemeData != null) {
                textboxThemeData = JSON.parse(textboxThemeData);
                textBoxThemeID = textboxThemeData.theme;
                if (textBoxThemeID == "chrome") {
                    textBoxThemeImage = textboxThemeData.image;
                    textBoxGrid = textboxThemeData.grid;
                }
            }
            else {
                textBoxThemeID = "chrome";
                textBoxThemeImage = "../../assets/images/background-gradient.png";
                textBoxGrid = true;
            }
            editor.setTheme(`ace/theme/${textBoxThemeID}`);

            if (textBoxThemeImage != false) {
                if (textBoxGrid) {
                    _id("configurableStyle").innerHTML = `#editor {
                        background: url(../../assets/images/background-grid.png), url(${textBoxThemeImage});
                        background-position: center, center;
                        background-size: contain, cover;
                    } `;
                }
                else {
                    _id("configurableStyle").innerHTML = `#editor {
                        background: url(${textBoxThemeImage});
                        background-position: center;
                        background-size: cover;
                    } `;
                }
            }
            else {
                _id("configurableStyle").innerHTML = "";
            }
        }

        ipcRenderer.on("check-textbox-theme-check", (event, data)=>{
            refreshTextboxTheme();
        })
        refreshTextboxTheme();




    </script>
</body>
</html>